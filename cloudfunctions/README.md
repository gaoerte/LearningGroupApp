# 云函数部署指南

## 📋 部署步骤

### 1. 上传云函数

在 HBuilderX 中：
1. 右键点击 `cloudfunctions/wechatLogin` 文件夹
2. 选择 "上传并部署：云端安装依赖"
3. 等待部署完成

### 2. 配置权限

确保云函数具有以下权限：
- `auth.code2Session` - 获取微信用户openid

### 3. 设置超时时间

在云开发控制台中：
1. 进入云函数管理
2. 选择 `wechatLogin` 函数  
3. 在"函数配置"中设置：
   - 超时时间：10秒
   - 内存：128MB（默认即可）

## 🔧 云函数说明

### wechatLogin
- **功能**：处理微信登录，获取用户openid
- **超时时间**：10秒
- **依赖**：仅 wx-server-sdk
- **优化**：移除了Supabase调用，避免超时

### userData（可选）
- **功能**：处理用户数据的增删改查
- **用途**：后期扩展用户功能时使用
- **依赖**：包含 Supabase SDK

## 📊 性能优化

### 已实施的优化：
1. **简化登录流程** - 移除耗时的Supabase操作
2. **减少依赖** - 登录云函数只保留必要依赖
3. **增加重试机制** - 前端自动重试失败的请求
4. **延长超时时间** - 从3秒增加到10秒

### 监控要点：
- 云函数执行时间
- 成功率统计
- 错误日志分析

## 🚨 故障排除

### 常见问题：

1. **超时错误**
   - 检查网络连接
   - 重新部署云函数
   - 清除云函数缓存

2. **权限错误**
   - 检查 config.json 权限配置
   - 确认微信小程序AppID正确

3. **依赖错误**
   - 重新安装云函数依赖
   - 检查 package.json 配置

## 📝 测试验证

部署完成后，请测试：
1. 微信登录功能
2. 查看云函数日志
3. 确认响应时间在可接受范围内
