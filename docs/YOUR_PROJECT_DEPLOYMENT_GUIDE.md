# 🎯 您的项目专用：云函数部署完整指南

## 🚀 快速开始（推荐方法）

### 方法1：直接在微信开发者工具中部署

#### 第一步：准备工作
1. **打开微信开发者工具**
2. **导入项目**：
   - 项目目录：`/Users/sanshuifengyu/Documents/HBuilderProjects/LearningGroupApp`
   - AppID：`wx6c6b5402b09209bf`（已在您的 manifest.json 中配置）

#### 第二步：开通云开发
1. 点击微信开发者工具顶部的 **"云开发"** 按钮
2. 如果是第一次使用：
   - 点击 **"开通云开发"**
   - 选择 **"基础版-免费"**（足够测试使用）
   - 创建环境ID（建议命名：learning-group-env）
3. 等待环境创建完成（约1-2分钟）

#### 第三步：部署云函数（按推荐顺序）

**🎯 第一个部署：supabaseProxySimple（简化版）**
1. 在项目文件树中找到 `cloudfunctions/supabaseProxySimple`
2. **右键点击** `supabaseProxySimple` 文件夹
3. 选择 **"上传并部署：云端安装依赖"**（重要：必须选择云端安装依赖）
4. 等待部署完成（约1-3分钟）

**🎯 第二个部署：supabaseProxy（完整版）**
1. 右键点击 `cloudfunctions/supabaseProxy` 文件夹
2. 选择 **"上传并部署：云端安装依赖"**
3. 等待部署完成

**🎯 其他云函数（可选）**
- `userData` - 用户数据管理
- `wechatLogin` - 微信登录功能

#### 第四步：验证部署
1. 在微信开发者工具中，点击 **"云开发"** > **"云函数"**
2. 检查函数列表，确认状态为 **"部署成功"**
3. 使用我们的测试页面验证连接：`pages/test/supabaseQuickTest`

---

## 🔧 方法2：使用改进的 Vite 配置（自动复制）

我已经为您更新了 `vite.config.js`，现在支持自动复制云函数！

### 使用步骤：
1. **编译项目**：
   ```bash
   npm run build:mp-weixin
   ```
2. **云函数会自动复制到**：
   ```
   unpackage/dist/build/mp-weixin/cloudfunctions/
   ```
3. **在微信开发者工具中**：
   - 右键点击复制后的云函数文件夹
   - 选择"上传并部署：云端安装依赖"

---

## 🔧 方法3：使用部署脚本

运行我为您创建的部署辅助脚本：

```bash
cd /Users/sanshuifengyu/Documents/HBuilderProjects/LearningGroupApp
./scripts/deploy-cloud-functions.sh
```

这个脚本会：
- 检查项目结构
- 列出所有可用的云函数
- 提供详细的部署指导

---

## ⚠️ 常见问题及解决方案

### 问题1：云函数上传失败 (-501000 错误)
**原因**：云函数不存在或未正确部署
**解决方案**：
1. 确保选择的是"云端安装依赖"
2. 检查云函数代码是否有语法错误
3. 尝试删除云端同名函数后重新上传

### 问题2：找不到云开发按钮
**解决方案**：
1. 确保微信开发者工具版本 ≥ 1.05
2. 确保项目 AppID 正确设置
3. 重启微信开发者工具

### 问题3：权限不足
**解决方案**：
1. 确保微信账号是小程序的开发者或管理员
2. 在小程序后台添加云开发权限

### 问题4：依赖安装超时
**解决方案**：
1. 检查网络连接
2. 重试部署
3. 简化 package.json 依赖

---

## 🎯 为您定制的部署计划

基于您的项目，我强烈建议按以下顺序操作：

### ✅ 第一阶段：基础连接测试
1. **部署** `supabaseProxySimple`
2. **测试** 使用 `pages/test/supabaseQuickTest` 页面
3. **验证** Supabase 连接是否正常

### ✅ 第二阶段：完整功能部署
1. **部署** `supabaseProxy`
2. **测试** 数据库操作功能
3. **验证** 前端 API 调用

### ✅ 第三阶段：业务功能部署
1. **部署** `userData`（用户管理）
2. **部署** `wechatLogin`（微信登录）
3. **测试** 完整业务流程

---

## 📱 测试连接的快捷方式

部署完成后，立即测试连接：

1. **打开小程序**
2. **进入首页**
3. **点击底部** "🔌 测试 Supabase 连接" 按钮
4. **查看测试结果**

如果看到绿色的成功状态，说明云函数部署成功！

---

## 🆘 如果还有问题

请提供以下信息：
1. 微信开发者工具的版本号
2. 具体的错误提示截图
3. 云开发控制台的日志信息
4. 您选择的具体部署方法

我会根据具体情况为您进一步调整解决方案！

---

## 💡 成功部署的标志

✅ 云开发控制台显示函数"部署成功"
✅ 测试页面连接成功
✅ 控制台无错误日志
✅ 前端可以正常调用云函数

祝您部署顺利！🎉
