# 云函数部署完整指南

## 🎯 方案1：微信开发者工具直接部署（推荐）

### 步骤1：确保项目配置正确

确保您的 `manifest.json` 文件包含正确的云开发配置：

```json
{
  "mp-weixin": {
    "appid": "wx6c6b5402b09209bf",
    "cloudfunctionRoot": "./cloudfunctions/",
    "usingComponents": true,
    "setting": {
      "miniprogram": {
        "libVersion": "3.7.0"
      }
    }
  }
}
```

✅ 您的配置已经正确！

### 步骤2：在微信开发者工具中打开项目

1. 打开微信开发者工具
2. 导入项目：选择您的项目目录
3. 确保 AppID 设置为：`wx6c6b5402b09209bf`

### 步骤3：开通云开发环境

1. 在微信开发者工具中，点击顶部的"云开发"按钮
2. 如果是第一次使用，会提示开通云开发
3. 按照提示创建环境（建议选择免费版本）
4. 记录环境ID（类似：cloud1-xxx）

### 步骤4：部署云函数

#### 方法A：右键菜单部署
1. 在微信开发者工具的项目文件树中，展开 `cloudfunctions` 文件夹
2. 右键点击要部署的云函数文件夹（如 `supabaseProxySimple`）
3. 选择：**"上传并部署：云端安装依赖"**
4. 等待部署完成（通常1-3分钟）

#### 方法B：云开发控制台部署
1. 点击微信开发者工具顶部的"云开发"按钮
2. 进入"云函数"页面
3. 点击"新建云函数"
4. 上传对应的云函数代码

### 步骤5：验证部署结果

1. 在"云开发" > "云函数"页面查看函数列表
2. 确认函数状态为"部署成功"
3. 可以在"日志"页面查看函数执行情况

---

## 🎯 方案2：使用 HBuilderX 的云函数功能

### 前提条件
确保您使用的是 HBuilderX（而不是 VS Code）

### 操作步骤
1. 在 HBuilderX 中打开项目
2. 右键点击 `cloudfunctions` 文件夹
3. 选择"上传所有云函数"或单独上传
4. 按照提示配置云开发环境

---

## 🎯 方案3：命令行部署（高级用户）

### 安装微信开发者工具命令行
```bash
# 下载并安装微信开发者工具
# 然后使用命令行工具
```

### 使用命令行部署
```bash
# 登录
cli login

# 上传云函数
cli cloudfunctions deploy
```

---

## 🔧 常见问题及解决方案

### 问题1：找不到云开发按钮
**解决方案：**
- 确保微信开发者工具版本 ≥ 1.05
- 确保项目类型是"小程序"
- 检查 AppID 是否正确设置

### 问题2：云函数上传失败
**解决方案：**
- 检查网络连接
- 确保云开发环境已开通
- 检查云函数代码是否有语法错误
- 尝试删除 `node_modules` 后重新上传

### 问题3：权限不足
**解决方案：**
- 确保微信开发者账号有云开发权限
- 联系小程序管理员添加权限

### 问题4：依赖安装失败
**解决方案：**
- 使用"云端安装依赖"而不是"本地安装依赖"
- 检查 `package.json` 是否正确
- 删除本地 `node_modules` 文件夹

---

## 📋 推荐的部署顺序

1. **先部署简化版：** `supabaseProxySimple`
2. **测试连接：** 使用快速测试页面验证
3. **再部署完整版：** `supabaseProxy`
4. **部署其他函数：** 按需部署其他云函数

---

## 🎯 为您定制的部署计划

基于您的项目，我建议按以下顺序操作：

### 第一步：部署简化版云函数
```
cloudfunctions/supabaseProxySimple/
├── index.js          # 已优化，依赖最少
├── package.json      # 只依赖 wx-server-sdk
└── .gitignore        # 已配置
```

### 第二步：验证部署
使用我们刚创建的 `supabaseQuickTest.vue` 页面测试连接

### 第三步：根据需要部署其他函数
- `supabaseProxy` - 完整功能版本
- `userData` - 用户数据管理
- `wechatLogin` - 微信登录

---

## 💡 小贴士

1. **首次部署建议用简化版云函数**，成功率更高
2. **云端安装依赖比本地安装更稳定**
3. **部署前检查代码语法，避免部署失败**
4. **关注控制台输出，及时发现问题**

您现在可以按照方案1进行操作，如果遇到任何问题，请告诉我具体的错误信息！
